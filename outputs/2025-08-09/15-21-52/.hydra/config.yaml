experiment:
  name: test_run_1_bandit_music48_gru
data:
  _target_: banda.data.datamodule.SourceSeparationDataModule
  dataset_name: musdb18hq
  batch_size: 4
  num_workers: 8
  pin_memory: true
  data_root: ${oc.env:DATA_ROOT,/Users/kwatcharasupat/personal/data}
  train_dataset_config:
    _target_: ${DATASETS_REGISTRY.get:musdb18hq}
    config:
      split: train
      dataset_connector:
        _target_: banda.data.datasets.musdb18hq.MUSDB18Connector
        config:
          split: train
          data_root: ${oc.env:DATA_ROOT,/Users/kwatcharasupat/personal/data}/musdb18hq/intermediates/npz
      fs: 44100
      premix_transform:
        _target_: banda.data.augmentations.base.ComposePreMixTransforms
        transforms:
        - _target_: banda.data.samplers.random_chunk.RandomChunkingTransform
          config:
            chunk_size_seconds: 3.0
            fs: 44100
            align_sources: true
      postmix_transform:
        _target_: banda.data.augmentations.base.ComposePostMixTransforms
        transforms:
        - _target_: banda.data.augmentations.time_domain.Gain
          config:
            min_gain_db: -6.0
            max_gain_db: 6.0
        - _target_: banda.data.augmentations.time_domain.NormalizeAudio
          config:
            target_rms_db: -20.0
  val_dataset_config:
    _target_: ${DATASETS_REGISTRY.get:musdb18hq}
    config:
      split: val
      dataset_connector:
        _target_: banda.data.datasets.musdb18hq.MUSDB18Connector
        config:
          split: val
          data_root: ${oc.env:DATA_ROOT,/Users/kwatcharasupat/personal/data}/musdb18hq/intermediates/npz
      fs: 44100
      premix_transform: null
      postmix_transform: null
model:
  _target_: ${MODELS_REGISTRY.get:bandit}
  input_channels: 2
  output_channels: 2
  hidden_features: 128
  num_sources: 4
  stft:
    _target_: banda.models.common_components.configs.common_configs.STFTConfig
    n_fft: 2048
    win_length: 2048
    hop_length: 512
    window_fn: hann_window
    wkwargs: null
    power: null
    center: true
    normalized: true
    pad_mode: constant
    onesided: true
  tfmodel:
    _target_: ${MODELS_REGISTRY.get:seq_band_modelling}
    rnn_type: gru
    n_modules: 2
    hidden_features: 256
    dropout: 0.1
    bidirectional: true
    emb_dim: 128
  bandsplit:
    _target_: banda.models.common_components.spectral_components.bandsplit.BandsplitModule
    config:
      _target_: banda.models.common_components.configs.common_configs.BandsplitModuleConfig
      band_specs:
        _target_: banda.models.common_components.configs.bandsplit_configs.MusicalBandsplitSpecsConfig
        n_bands: 48
        drop_dc_band: true
      n_fft: ${model.stft.n_fft}
      fs: ${data.train_dataset_config.config.fs}
      require_no_overlap: false
      require_no_gap: false
      normalize_channel_independently: false
      treat_channel_as_feature: false
      drop_dc_band: true
loss:
  _target_: banda.losses.separation_loss_handler.SeparationLossHandler
  loss_fn:
    _target_: banda.losses.multi_resolution_l1_snr.MultiResolutionSTFTLoss
    n_ffts:
    - 2048
    - 512
    hop_lengths:
    - 512
    - 128
    win_lengths:
    - 2048
    - 512
    mag_weight: 1.0
    phase_weight: 0.0
    log_scale: false
metrics:
  _target_: torchmetrics.audio.ScaleInvariantSignalNoiseRatio
optimizer:
  _target_: torch.optim.Adam
  lr: 0.001
trainer:
  _target_: pytorch_lightning.Trainer
  accelerator: auto
  devices: auto
  max_epochs: 10
  precision: 32
  log_every_n_steps: 10
logger:
  _target_: pytorch_lightning.loggers.WandbLogger
  project: banda
  log_model: all
