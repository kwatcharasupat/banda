project_root: ${oc.env:PROJECT_ROOT,.}
experiment_name: bandit_musdb18hq_test
seed: 42
log_level: INFO
paths:
  output_dir: ${hydra.run.dir}
  log_dir: ${hydra.run.dir}/logs
  data_dir: ${project_root}/data
data:
  target_: banda.data.datamodule.SourceSeparationDataModule
  batch_size: 2
  num_workers: 0
  pin_memory: false
  train_dataset_config:
    target_: banda.data.datasets.musdb18hq.MUSDB18HQDataset
    config:
      split: train
      fs: 44100
      premix_transform:
        target_: banda.data.samplers.random_chunk.RandomChunkingTransform
        chunk_size_seconds: 0.5
        fs: 44100
      dataset_connector:
        target_: banda.data.datasets.musdb18hq.MUSDB18Connector
        config:
          split: train
          data_root: ${oc.env:MUSDB18HQ_DATA_ROOT,${project_root}/data/musdb18hq/intermediates/npz}
  val_dataset_config:
    target_: banda.data.datasets.musdb18hq.MUSDB18HQDataset
    config:
      split: val
      fs: 44100
      premix_transform:
        target_: banda.data.samplers.random_chunk.RandomChunkingTransform
        chunk_size_seconds: 0.5
        fs: 44100
      dataset_connector:
        target_: banda.data.datasets.musdb18hq.MUSDB18Connector
        config:
          split: val
          data_root: ${oc.env:MUSDB18HQ_DATA_ROOT,${project_root}/data/musdb18hq/intermediates/npz}
  test_dataset_config:
    target_: banda.data.datasets.musdb18hq.MUSDB18HQDataset
    config:
      split: test
      fs: 44100
      premix_transform:
        target_: banda.data.samplers.random_chunk.RandomChunkingTransform
        chunk_size_seconds: 3.0
        fs: 44100
      dataset_connector:
        target_: banda.data.datasets.musdb18hq.MUSDB18Connector
        config:
          split: test
          data_root: ${oc.env:MUSDB18HQ_DATA_ROOT,${project_root}/data/musdb18hq/intermediates/npz}
trainer:
  _target_: pytorch_lightning.Trainer
  max_epochs: 1
  accelerator: auto
  devices: auto
  log_every_n_steps: 1
  limit_train_batches: 5
  limit_val_batches: 5
  gradient_clip_val: 5.0
  gradient_clip_algorithm: norm
loss:
  _target_: banda.losses.separation_loss_handler.SeparationLossHandler
  loss_config:
    _target_: banda.losses.loss_configs.LossCollectionConfig
    losses:
      stft_loss:
        fn:
          _target_: banda.losses.multi_resolution_l1_snr.MultiResolutionSTFTLoss
          n_ffts:
          - 2048
          - 512
          hop_lengths:
          - 512
          - 128
          win_lengths:
          - 2048
          - 512
        weight: 1.0
      time_loss:
        fn:
          _target_: banda.losses.time_domain_loss.TimeDomainLoss
        weight: 0.5
      l1_loss:
        fn:
          _target_: torch.nn.L1Loss
        weight: 0.1
      l2_loss:
        fn:
          _target_: torch.nn.MSELoss
        weight: 0.1
      l1_snr_loss:
        fn:
          _target_: banda.losses.coda_losses.L1SNRLoss
        weight: 0.1
      decibel_match_loss:
        fn:
          _target_: banda.losses.coda_losses.DecibelMatchLoss
        weight: 0.1
      l1_snr_decibel_match_loss:
        fn:
          _target_: banda.losses.coda_losses.L1SNRDecibelMatchLoss
        weight: 0.1
metrics:
  _target_: torchmetrics.audio.ScaleInvariantSignalNoiseRatio
inference:
  chunk_size_seconds: 6.0
  hop_size_seconds: 3.0
  fs: 44100
  batch_size: 4
optimizer:
  _target_: torch.optim.Adam
  lr: 0.001
model:
  input_channels: 2
  bandsplit:
    _target_: banda.models.common_components.configs.common_configs.BandsplitModuleConfig
    band_specs:
      _target_: banda.models.common_components.configs.bandsplit_configs._bandsplit_definitions.ERBBandsplitSpecsConfig
      bandsplit_type: erb
      n_bands: 32
  stft:
    _target_: banda.models.common_components.configs.common_configs.STFTConfig
    n_fft: 2048
    win_length: 2048
    hop_length: 512
    window_fn: hann_window
    wkwargs: null
    power: null
    center: true
    normalized: true
    pad_mode: constant
    onesided: true
  tfmodel:
    _target_: banda.models.common_components.time_frequency_models.tf_models.SeqBandModellingModule
    n_modules: 12
    emb_dim: 128
    rnn_dim: 256
    bidirectional: true
    rnn_type: GRU
    tf_dropout: 0.0
  mask_estim:
    _target_: banda.models.common_components.configs.common_configs.MaskEstimationConfig
    mask_estimation_type: non_overlapping
    mlp_dim: 512
    hidden_activation: Tanh
    hidden_activation_kwargs: null
    complex_mask: true
    use_freq_weights: false
    in_channel: ${model.input_channels}
_group_:
  _target_: banda.models.common_components.configs.common_configs.BandsplitModuleConfig
  input_channels: 2
  output_channels: 2
  hidden_features: 256
  num_sources: 4
  bandsplit: bandsplit_music_32
  batch_size: 4
  num_workers: 4
  pin_memory: true
  train_dataset_config:
    _target_: banda.data.datasets.musdb18hq.MUSDB18HQDataset
    config:
      split: train
      dataset_connector:
        _target_: banda.data.datasets.musdb18hq.MUSDB18Connector
        config:
          split: train
          data_root: ${oc.env:DATA_ROOT}/musdb18hq/intermediates/npz
      fs: 44100
      premix_transform:
        _target_: banda.data.augmentations.base.ComposePreMixTransforms
        transforms:
        - _target_: banda.data.samplers.random_chunk.RandomChunkingTransform
          config:
            chunk_size_seconds: 3.0
            fs: 44100
            align_sources: true
      postmix_transform:
        _target_: banda.data.augmentations.base.ComposePostMixTransforms
        transforms:
        - _target_: banda.data.augmentations.time_domain.Gain
          config:
            min_gain_db: -6.0
            max_gain_db: 6.0
        - _target_: banda.data.augmentations.time_domain.NormalizeAudio
          config:
            target_rms_db: -20.0
  val_dataset_config:
    _target_: banda.data.datasets.musdb18hq.MUSDB18HQDataset
    config:
      split: val
      dataset_connector:
        _target_: banda.data.datasets.musdb18hq.MUSDB18Connector
        config:
          split: val
          data_root: ${oc.env:DATA_ROOT}/musdb18hq/intermediates/npz
      fs: 44100
      premix_transform: null
      postmix_transform: null
  max_epochs: 5
  accelerator: auto
  devices: auto
  log_every_n_steps: 50
  project: banda
  name: ${experiment.name}
  save_dir: ${paths.output_dir}
  offline: false
  id: null
  version: null
  band_specs:
    _target_: banda.models.common_components.configs.bandsplit_configs._bandsplit_definitions.ERBBandsplitSpecsConfig
    bandsplit_type: erb
    n_bands: 32
  require_no_overlap: true
  require_no_gap: true
  normalize_channel_independently: false
  treat_channel_as_feature: false
experiment:
  name: test_run_4_bandit_erb32_gru
